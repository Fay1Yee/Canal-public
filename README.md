# Ê∞¥‰∏ä‰π¶ WaterBook

üåä **ËøêÊ≤≥ÁéØÂ¢ÉÂ£∞Èü≥Ëâ∫ÊúØÁîüÊàêÂô®** - ÈááÈõÜËøêÊ≤≥ÁéØÂ¢ÉÂ£∞Èü≥ÁâπÂæÅÔºåÁîüÊàêÁã¨ÁâπÁöÑÊ∞¥Â¢®È£éÊ†ºËâ∫ÊúØ‰ΩúÂìÅ

## üìñ È°πÁõÆÊ¶ÇËø∞

Ê∞¥‰∏ä‰π¶ÊòØ‰∏Ä‰∏™ÂàõÊñ∞ÁöÑÁéØÂ¢ÉÂ£∞Èü≥Ëâ∫ÊúØÁîüÊàêÁ≥ªÁªüÔºå‰∏ìÈó®ÈááÈõÜÂíåÂàÜÊûêËøêÊ≤≥ÁéØÂ¢É‰∏≠ÁöÑËá™ÁÑ∂Â£∞Èü≥ÔºàÊ∞¥ÊµÅÂ£∞„ÄÅËàπÂè™Â£∞„ÄÅÈ∏üÈ∏£Â£∞„ÄÅÈ£éÂ£∞Á≠âÔºâÔºåËøêÁî®Âü∫‰∫éËßÑÂàôÁöÑÊò†Â∞ÑÁÆóÊ≥ïÁîüÊàêÁõ∏Â∫îÁöÑÊ∞¥Â¢®‰π¶Ê≥ïËâ∫ÊúØÂèÇÊï∞ÔºåÊúÄÁªàËæìÂá∫ÂåÖÂê´Â∞ÅÈù¢ÂõæÂÉè„ÄÅÂä®ÁîªËßÜÈ¢ëÂíåÂÖÉÊï∞ÊçÆÁöÑÂÆåÊï¥Ëâ∫ÊúØ‰ΩúÂìÅ„ÄÇ

### ‚ú® Ê†∏ÂøÉÁâπËâ≤

- üéµ **ËøêÊ≤≥ÁéØÂ¢ÉÂ£∞Èü≥ÈááÈõÜ‰∏éÂàÜÊûê** - ‰∏ì‰∏öÈááÈõÜ35ÁßíËøêÊ≤≥ÁéØÂ¢ÉÂ£∞Èü≥ÔºåÊèêÂèñÊ∞¥ÊµÅ„ÄÅËàπÂè™„ÄÅÈ∏üÁ±ªÁ≠âÁâπÂæÅ
- üñåÔ∏è **Êô∫ËÉΩÊ∞¥Â¢®Ëâ∫ÊúØÊò†Â∞Ñ** - Â∞ÜÁéØÂ¢ÉÂ£∞Èü≥ÁâπÂæÅÊò†Â∞Ñ‰∏∫Ê∞¥Â¢®ÂèÇÊï∞ÔºàÁ¨îÈÄü„ÄÅÁ≤óÁªÜ„ÄÅÈ£ûÁôΩ„ÄÅÂ¢®Êôï„ÄÅÂÅúÈ°øÂº∫Â∫¶Á≠âÔºâ
- üé≠ **Â§öÈ£éÊ†ºÁîüÊàê** - Êèê‰æõË°å‰π¶„ÄÅÁØÜ‰π¶„ÄÅÊ∞¥Â¢®ÊôïÊüì‰∏âÁßç‰π¶Ê≥ïÈ£éÊ†º
- üì± **Ê≤âÊµ∏ÂºèËøêÊ≤≥Âú∫ÊôØÁïåÈù¢** - Âü∫‰∫éPygameÁöÑÂÖ®Â±è‰∫§‰∫íÁïåÈù¢ÔºåÂëàÁé∞ÂÆåÊï¥ËøêÊ≤≥ÁéØÂ¢É
- üåê **Êú¨Âú∞WebÊúçÂä°** - Ëá™Âä®ÁîüÊàêÁ≤æÁæé‰∏ãËΩΩÈ°µÈù¢ÔºåÊîØÊåÅ‰∫åÁª¥Á†ÅÂàÜ‰∫´
- üîß **Ë∑®Âπ≥Âè∞ÂÖºÂÆπ** - ÊîØÊåÅÊ†ëËéìÊ¥æGPIOÂíåÈîÆÁõòÊ®°ÊãüÔºåÈÄÇÈÖç‰∏çÂêåÁ°¨‰ª∂ÁéØÂ¢É

## üèóÔ∏è Á≥ªÁªüÊû∂ÊûÑ

```
E0 Âê∏Âºï ‚Üí E1 ËÅÜÂê¨ ‚Üí E2 ÈááÈõÜ ‚Üí E3 ÁîüÊàê ‚Üí E4 ÈÄâÊã© ‚Üí E5 Â±ïÁ§∫ ‚Üí E6 ÈáçÁΩÆ
    ‚Üë                                                                        ‚Üì
    ‚îî‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ Âæ™ÁéØÁä∂ÊÄÅÊú∫ ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îÄ‚îò
```

### Áä∂ÊÄÅËØ¥Êòé

- **E0 Âê∏Âºï**: Â±ïÁ§∫ËøêÊ≤≥Ê∞¥Â¢®‰∏ªÈ¢òÔºåÁ≠âÂæÖÁî®Êà∑‰∫§‰∫í
- **E1 ËÅÜÂê¨**: ÁéØÂ¢ÉÂ£∞Èü≥Ê£ÄÊµãÂíåÈááÈõÜÂáÜÂ§áÔºà8ÁßíÔºâ
- **E2 ÈááÈõÜ**: ËøêÊ≤≥ÁéØÂ¢ÉÂ£∞Èü≥ÈááÈõÜÂíåÂÆûÊó∂È¢ëË∞±ÊòæÁ§∫Ôºà30-45ÁßíÔºâ
- **E3 ÁîüÊàê**: ÁéØÂ¢ÉÂ£∞Èü≥ÁâπÂæÅÂàÜÊûêÂíåÂÜÖÂÆπÁîüÊàêÔºà‚â§2ÁßíÔºâ
- **E4 ÈÄâÊã©**: Ê∞¥Â¢®È£éÊ†ºÈÄâÊã©ÁïåÈù¢Ôºà5-10ÁßíÔºâ
- **E5 Â±ïÁ§∫**: Ëâ∫ÊúØ‰ΩúÂìÅÂ±ïÁ§∫Âíå‰∏ãËΩΩÈ°µÈù¢Ôºà10-15ÁßíÔºâ
- **E6 ÈáçÁΩÆ**: Ê∏ÖÁêÜÂíåÈáçÁΩÆÔºà5ÁßíÔºâ

## üåä ËøêÊ≤≥ÁéØÂ¢ÉÂ£∞Èü≥ÁâπÂæÅ

### ‰∏ì‰∏öÂ£∞Èü≥ËØÜÂà´
- **Ê∞¥ÊµÅÂ£∞Ê£ÄÊµã** (50-500 Hz) - ËØÜÂà´ËøêÊ≤≥Ê∞¥ÊµÅÁöÑËøûÁª≠ÊÄßÂíåÂº∫Â∫¶
- **ËàπÂè™ÂºïÊìéÂ£∞** (100-1000 Hz) - Ê£ÄÊµãËàπÂè™Ëà™Ë°åÂíåÂºïÊìéÁâπÂæÅ
- **È∏üÁ±ªÊ¥ªÂä®** (1000-8000 Hz) - ÊçïÊçâËøêÊ≤≥Ê≤øÂ≤∏È∏üÁ±ªÈ∏£Âè´
- **È£éÂ£∞ÁéØÂ¢ÉÈü≥** (20-200 Hz) - ÂàÜÊûêÁéØÂ¢ÉÈ£éÂ£∞ÂíåÊ∞õÂõ¥Èü≥

### ÁéØÂ¢ÉÊåáÊ†áËÆ°ÁÆó
- **Ê∞¥ÊµÅÊåáÁ§∫Âô®** - Âü∫‰∫é‰ΩéÈ¢ë‰∏ÄËá¥ÊÄßÁöÑÊ∞¥ÊµÅÊ£ÄÊµã
- **ËàπÂè™Ê¥ªÂä®ÊåáÁ§∫Âô®** - ‰∏≠È¢ëÂ≥∞ÂÄºÁöÑËàπÂè™Ê£ÄÊµã
- **È∏üÁ±ªÊ¥ªÂä®ÊåáÁ§∫Âô®** - È´òÈ¢ëÁ™ÅÂèëÁöÑÈ∏üÁ±ªÊ£ÄÊµã
- **ËøêÊ≤≥Ê∞õÂõ¥ÁªºÂêàËØÑÂàÜ** - Â§öÁâπÂæÅËûçÂêàÁöÑÁéØÂ¢ÉËØÑ‰º∞

## üìã Á≥ªÁªüË¶ÅÊ±Ç

### Á°¨‰ª∂Ë¶ÅÊ±Ç

- **Êé®Ëçê**: Ê†ëËéìÊ¥æ 4B/5 (4GB+ RAM)
- **ÊúÄ‰Ωé**: ÊîØÊåÅPython 3.8+ÁöÑ‰ªªÊÑèËÆæÂ§á
- **Èü≥È¢ë**: È´òË¥®ÈáèÈ∫¶ÂÖãÈ£éÊàñÈü≥È¢ëËæìÂÖ•ËÆæÂ§áÔºàÁî®‰∫éÁéØÂ¢ÉÂ£∞Èü≥ÈááÈõÜÔºâ
- **ÊòæÁ§∫**: 1280x720ÊàñÊõ¥È´òÂàÜËæ®ÁéáÊòæÁ§∫Âô®
- **Â≠òÂÇ®**: Ëá≥Â∞ë2GBÂèØÁî®Á©∫Èó¥

### ËΩØ‰ª∂Ë¶ÅÊ±Ç

- **Êìç‰ΩúÁ≥ªÁªü**: Linux (Êé®ËçêÊ†ëËéìÊ¥æOS)„ÄÅmacOS„ÄÅWindows
- **Python**: 3.8ÊàñÊõ¥È´òÁâàÊú¨
- **Èü≥È¢ëÁ≥ªÁªü**: ALSA/PulseAudio (Linux) ÊàñÁ≥ªÁªüÈªòËÆ§ (macOS/Windows)

## üöÄ Âø´ÈÄüÂºÄÂßã

### 1. ÂÖãÈöÜÈ°πÁõÆ

```bash
git clone https://github.com/your-repo/canal-ink-wash.git
cd canal-ink-wash
```

### 2. ÂÆâË£Ö‰æùËµñ

```bash
# ‰ΩøÁî®ËÑöÊú¨Ëá™Âä®ÂÆâË£Ö
./scripts/run.sh -i

# ÊàñÊâãÂä®ÂÆâË£Ö
pip3 install -r requirements.txt
```

### 3. ËøêË°åÂ∫îÁî®

```bash
# Áõ¥Êé•ËøêË°å
python3 app.py

# Êàñ‰ΩøÁî®ÂêØÂä®ËÑöÊú¨
./scripts/run.sh

# ÈùûÊ†ëËéìÊ¥æÁéØÂ¢ÉÔºà‰ΩøÁî®ÈîÆÁõòÊ®°ÊãüÔºâ
./scripts/run.sh --no-gpio
```

## ‚öôÔ∏è ÈÖçÁΩÆ

### config.yaml ÈÖçÁΩÆÊñá‰ª∂

```yaml
audio:
  samplerate: 32000      # ÈááÊ†∑Áéá
  channels: 1            # Â£∞ÈÅìÊï∞
  record_seconds: 35     # ÁéØÂ¢ÉÂ£∞Èü≥ÈááÈõÜÊó∂Èïø
  frame_ms: 20          # Â∏ßÈïøÂ∫¶
  band_splits_hz: [300, 2000]  # È¢ëÂ∏¶ÂàÜÂâ≤ÁÇπ

gpio:
  button_pin: 17        # GPIOÊåâÈíÆÂºïËÑö
  long_press_sec: 1.2   # ÈïøÊåâÊó∂Èó¥ÈòàÂÄº

ui:
  width: 1280           # ÁïåÈù¢ÂÆΩÂ∫¶
  height: 720           # ÁïåÈù¢È´òÂ∫¶
  font: "assets/fonts/NotoSansSC-Regular.otf"  # Â≠ó‰ΩìÊñá‰ª∂

server:
  port: 8000            # WebÊúçÂä°Á´ØÂè£

states:
  E1_seconds: 8         # ÂêÑÁä∂ÊÄÅÊåÅÁª≠Êó∂Èó¥
  E4_seconds: 8
  E5_seconds: 12
  E6_seconds: 5
```

## üéÆ ‰ΩøÁî®ËØ¥Êòé

### Ê†ëËéìÊ¥æGPIOÊìç‰Ωú

- **GPIO17 Áü≠Êåâ**: Á°ÆËÆ§/‰∏ã‰∏ÄÊ≠•
- **GPIO17 ÈïøÊåâ**: ÁâπÊÆäÊìç‰ΩúÔºàË∑≥ËøáÂÄíËÆ°Êó∂Á≠âÔºâ

### ÈîÆÁõòÊìç‰ΩúÔºàÈùûGPIOÁéØÂ¢ÉÔºâ

- **Á©∫Ê†ºÈîÆ**: Áü≠ÊåâÊìç‰Ωú
- **ÂõûËΩ¶ÈîÆ**: ÈïøÊåâÊìç‰Ωú
- **ESCÈîÆ**: ÈÄÄÂá∫Â∫îÁî®
- **F11ÈîÆ**: ÂàáÊç¢ÂÖ®Â±è

### ÁïåÈù¢ÂØºËà™

1. **E0 Âê∏Âºï**: Êåâ‰ªªÊÑèÈîÆÂºÄÂßãËÅÜÂê¨ËøêÊ≤≥ÁéØÂ¢É
2. **E1 ËÅÜÂê¨**: ‰øùÊåÅÂÆâÈùôÔºåËÆ©ËÆæÂ§áÊ£ÄÊµãÁéØÂ¢ÉÂ£∞Èü≥
3. **E2 ÈááÈõÜ**: Á≥ªÁªüËá™Âä®ÈááÈõÜËøêÊ≤≥ÁéØÂ¢ÉÂ£∞Èü≥ÔºåËßÇÂØüÂÆûÊó∂È¢ëË∞±
4. **E3 ÁîüÊàê**: Ëá™Âä®Â§ÑÁêÜÁéØÂ¢ÉÂ£∞Èü≥ÁâπÂæÅÔºåËØ∑Á≠âÂæÖ
5. **E4 ÈÄâÊã©**: Áü≠ÊåâÂàáÊç¢Ê∞¥Â¢®È£éÊ†ºÔºåÈïøÊåâÁ°ÆËÆ§ÈÄâÊã©
6. **E5 Â±ïÁ§∫**: Êü•ÁúãËâ∫ÊúØ‰ΩúÂìÅÔºåÊâ´Êèè‰∫åÁª¥Á†Å‰∏ãËΩΩ
7. **E6 ÈáçÁΩÆ**: Ëá™Âä®ÈáçÁΩÆÂà∞E0

## üåä ËøêÊ≤≥ÂèØËßÜÂåñÁâπËâ≤

### Ê≤âÊµ∏ÂºèËøêÊ≤≥Âú∫ÊôØ
- **Âä®ÊÄÅÊ∞¥Ê≥¢** - Ê†πÊçÆÁéØÂ¢ÉÂ£∞Èü≥Âº∫Â∫¶ÂÆûÊó∂ÂèòÂåñÁöÑËøêÊ≤≥Ê∞¥Èù¢
- **Ëà™Ë°åËàπÂè™** - 3Ëâò‰∏çÂêåÂ§ßÂ∞èÁöÑËàπÂè™Âú®ËøêÊ≤≥‰∏≠Ëá™ÁÑ∂Ëà™Ë°å
- **‰º†ÁªüÊ°•Ê¢Å** - ËøêÊ≤≥ÁâπËâ≤Ê°•Ê¢ÅÔºåÈ¢úËâ≤ÈöèÈü≥È¢ëÁâπÂæÅÂèòÂåñ
- **Ê≤≥Â≤∏ÁéØÂ¢É** - ÂÆåÊï¥ÁöÑÂª∫Á≠ë„ÄÅÊ†ëÊú®„ÄÅÂ§©Á©∫ËøêÊ≤≥ÁéØÂ¢É

### ‰∏ì‰∏öÈü≥È¢ëÂèØËßÜÂåñ
- **È¢ëË∞±Ê∞¥Èù¢ÂèçÂ∞Ñ** - Èü≥È¢ëÈ¢ëË∞±‰ª•Ê∞¥Èù¢ÂèçÂ∞ÑÂΩ¢ÂºèÂëàÁé∞
- **ÁéØÂ¢ÉÂ£∞Èü≥ÊåáÁ§∫Âô®** - ÂÆûÊó∂ÊòæÁ§∫Ê∞¥ÊµÅ„ÄÅËàπÂè™„ÄÅÈ∏üÁ±ªÊ£ÄÊµãÁªìÊûú
- **ËøêÊ≤≥‰∏ªÈ¢òÈÖçËâ≤** - ËøêÊ≤≥Ëìù„ÄÅËøêÊ≤≥Áªø„ÄÅÊ°•Ê¢ÅÊ£ïÁ≠â‰∏ìÂ±ûËâ≤ÂΩ©

## üìÅ È°πÁõÆÁªìÊûÑ

```
canal-ink-wash/
‚îú‚îÄ‚îÄ app.py              # ‰∏ªÁ®ãÂ∫èÂÖ•Âè£
‚îú‚îÄ‚îÄ audio_rec.py        # ÁéØÂ¢ÉÂ£∞Èü≥ÈááÈõÜÂíåÁâπÂæÅÊèêÂèñ
‚îú‚îÄ‚îÄ canal_visualizer.py # ËøêÊ≤≥Âú∫ÊôØÂèØËßÜÂåñ
‚îú‚îÄ‚îÄ generator.py        # ÂÜÖÂÆπÁîüÊàêÂíåËßÑÂàôÊò†Â∞Ñ
‚îú‚îÄ‚îÄ visual.py           # UIÊ∏≤ÊüìÂíåÁïåÈù¢ÁªòÂà∂
‚îú‚îÄ‚îÄ ink_wash_pygame.py  # Ê∞¥Â¢®È£éÊ†ºÊ∏≤Êüì
‚îú‚îÄ‚îÄ server.py           # WebÊúçÂä°Âô®
‚îú‚îÄ‚îÄ config.yaml         # ÈÖçÁΩÆÊñá‰ª∂
‚îú‚îÄ‚îÄ requirements.txt    # Python‰æùËµñ
‚îú‚îÄ‚îÄ README.md          # È°πÁõÆÊñáÊ°£
‚îú‚îÄ‚îÄ assets/            # ËµÑÊ∫êÊñá‰ª∂
‚îÇ   ‚îú‚îÄ‚îÄ words.json     # Ë±°Â£∞ËØçËØçÂÖ∏
‚îÇ   ‚îú‚îÄ‚îÄ fonts/         # Â≠ó‰ΩìÊñá‰ª∂
‚îÇ   ‚îî‚îÄ‚îÄ icons/         # ÂõæÊ†áÊñá‰ª∂
‚îú‚îÄ‚îÄ www/               # WebËæìÂá∫ÁõÆÂΩï
‚îÇ   ‚îú‚îÄ‚îÄ index.html     # Ëá™Âä®ÁîüÊàêÁöÑ‰∏ªÈ°µ
‚îÇ   ‚îú‚îÄ‚îÄ cover.png      # ÁîüÊàêÁöÑÂ∞ÅÈù¢
‚îÇ   ‚îú‚îÄ‚îÄ loop.mp4       # ÁîüÊàêÁöÑÂä®Áîª
‚îÇ   ‚îú‚îÄ‚îÄ raw.wav        # ÈááÈõÜÁöÑÁéØÂ¢ÉÂ£∞Èü≥
‚îÇ   ‚îî‚îÄ‚îÄ meta.json      # ÂÖÉÊï∞ÊçÆ
‚îî‚îÄ‚îÄ scripts/           # ËÑöÊú¨Êñá‰ª∂
    ‚îú‚îÄ‚îÄ run.sh         # ÂêØÂä®ËÑöÊú¨
    ‚îî‚îÄ‚îÄ waterbook.service  # systemdÊúçÂä°
```

## üé® Ëâ∫ÊúØÁîüÊàêÂéüÁêÜ

### ÁéØÂ¢ÉÂ£∞Èü≥Âà∞Ëâ∫ÊúØÂèÇÊï∞Êò†Â∞Ñ

1. **Ê∞¥ÊµÅÂ£∞ÁâπÂæÅ** ‚Üí Á¨îÁîªÊµÅÁïÖÂ∫¶ÂíåËøûÁª≠ÊÄß
2. **ËàπÂè™Â£∞ÁâπÂæÅ** ‚Üí Á¨îÁîªÂäõÂ∫¶ÂíåËäÇÂ•èÂèòÂåñ
3. **È∏üÈ∏£Â£∞ÁâπÂæÅ** ‚Üí È£ûÁôΩÊïàÊûúÂíåÁÅµÂä®ÊÄß
4. **È£éÂ£∞ÁâπÂæÅ** ‚Üí Â¢®ÊôïÊâ©Êï£ÂíåÊ∞õÂõ¥ÊÑü

### Ê∞¥Â¢®È£éÊ†ºÁîüÊàê

- **Ë°å‰π¶È£éÊ†º** - ÊµÅÁïÖËá™ÁÑ∂ÔºåÈÄÇÂêàÊ∞¥ÊµÅÂ£∞‰∏ªÂØºÁöÑÁéØÂ¢É
- **ÁØÜ‰π¶È£éÊ†º** - Âè§Êú¥Â∫ÑÈáçÔºåÈÄÇÂêàÂÆÅÈùôÁöÑËøêÊ≤≥ÁéØÂ¢É
- **Ê∞¥Â¢®ÊôïÊüì** - Ëâ∫ÊúØË°®Áé∞ÔºåÈÄÇÂêà‰∏∞ÂØåÁöÑÁéØÂ¢ÉÂ£∞Èü≥

## üåê WebÊúçÂä°

Â∫îÁî®ÂêØÂä®Êú¨Âú∞WebÊúçÂä°ÔºàÁ´ØÂè£8000ÔºâÔºåÊèê‰æõ‰ª•‰∏ãÂäüËÉΩÔºö

- **Ëâ∫ÊúØ‰ΩúÂìÅÂ±ïÁ§∫È°µ**: `http://localhost:8000/`
- **Êñá‰ª∂‰∏ãËΩΩ**: Â∞ÅÈù¢ÂõæÂÉè„ÄÅÂä®ÁîªËßÜÈ¢ë„ÄÅÂéüÂßãÁéØÂ¢ÉÂ£∞Èü≥„ÄÅÂÖÉÊï∞ÊçÆ
- **‰∫åÁª¥Á†ÅÂàÜ‰∫´**: Ëá™Âä®ÁîüÊàêÂΩìÂâçIPÁöÑËÆøÈóÆ‰∫åÁª¥Á†Å
- **ÂìçÂ∫îÂºèËÆæËÆ°**: ÊîØÊåÅÊâãÊú∫ÂíåÂπ≥ÊùøËÆøÈóÆ

## üìÑ ËÆ∏ÂèØËØÅ

Êú¨È°πÁõÆÈááÁî®MITËÆ∏ÂèØËØÅ - ËØ¶ËßÅ [LICENSE](LICENSE) Êñá‰ª∂

## üôè Ëá¥Ë∞¢

- [Pygame](https://www.pygame.org/) - Ê∏∏ÊàèÂºÄÂèëÂ∫ì
- [librosa](https://librosa.org/) - Èü≥È¢ëÂàÜÊûêÂ∫ì
- [MoviePy](https://zulko.github.io/moviepy/) - ËßÜÈ¢ëÂ§ÑÁêÜÂ∫ì
- [Pillow](https://pillow.readthedocs.io/) - ÂõæÂÉèÂ§ÑÁêÜÂ∫ì

---

**ËøêÊ≤≥Ê∞¥Â¢®** - ËÅÜÂê¨ËøêÊ≤≥‰πãÂ£∞ÔºåÂàõÈÄ†Ê∞¥Â¢®‰πãÁæé üåäüé®‚ú®

## üìã System Requirements

### Hardware Requirements

- **Recommended**: Raspberry Pi 4B/5 (4GB+ RAM)
- **Minimum**: Any device supporting Python 3.8+
- **Audio**: Microphone or audio input device
- **Display**: 1280x720 or higher resolution monitor
- **Storage**: At least 2GB available space

### Software Requirements

- **Operating System**: Linux (recommended Raspberry Pi OS), macOS, Windows
- **Python**: 3.8 or higher
- **Audio System**: ALSA/PulseAudio (Linux) or system default (macOS/Windows)

## üöÄ Quick Start

### 1. Clone Project

```bash
git clone https://github.com/your-repo/waterbook-public.git
cd waterbook-public
```

### 2. Install Dependencies

```bash
# Use script for automatic installation
./scripts/run.sh -i

# Or install manually
pip3 install -r requirements.txt
```

### 3. Run Application

```bash
# Run directly
python3 app.py

# Or use startup script
./scripts/run.sh

# Non-Raspberry Pi environment (using keyboard simulation)
./scripts/run.sh --no-gpio
```

## üîß Detailed Installation

### Raspberry Pi Installation

1. **Update System**
   ```bash
   sudo apt update && sudo apt upgrade -y
   ```

2. **Install System Dependencies**
   ```bash
   sudo apt install -y python3-pip python3-dev python3-venv
   sudo apt install -y libasound2-dev portaudio19-dev
   sudo apt install -y libsdl2-dev libsdl2-image-dev libsdl2-mixer-dev libsdl2-ttf-dev
   sudo apt install -y ffmpeg
   ```

3. **Configure Audio Permissions**
   ```bash
   sudo usermod -a -G audio $USER
   ```

4. **Configure GPIO Permissions**
   ```bash
   sudo usermod -a -G gpio $USER
   ```

5. **Restart System**
   ```bash
   sudo reboot
   ```

### macOS/Linux Installation

1. **Install Homebrew** (macOS)
   ```bash
   /bin/bash -c "$(curl -fsSL https://raw.githubusercontent.com/Homebrew/install/HEAD/install.sh)"
   ```

2. **Install System Dependencies**
   ```bash
   # macOS
   brew install python3 portaudio ffmpeg sdl2 sdl2_image sdl2_mixer sdl2_ttf
   
   # Ubuntu/Debian
   sudo apt install python3-pip portaudio19-dev ffmpeg libsdl2-dev
   
   # CentOS/RHEL
   sudo yum install python3-pip portaudio-devel ffmpeg SDL2-devel
   ```

3. **Create Virtual Environment** (Recommended)
   ```bash
   python3 -m venv waterbook-env
   source waterbook-env/bin/activate  # Linux/macOS
   # waterbook-env\Scripts\activate  # Windows
   ```

## ‚öôÔ∏è Configuration

### config.yaml Configuration File

```yaml
audio:
  samplerate: 32000      # Sample rate
  channels: 1            # Number of channels
  record_seconds: 35     # Recording duration
  frame_ms: 20          # Frame length
  band_splits_hz: [300, 2000]  # Frequency band split points

gpio:
  button_pin: 17        # GPIO button pin
  long_press_sec: 1.2   # Long press time threshold

ui:
  width: 1280           # Interface width
  height: 720           # Interface height
  font: "assets/fonts/NotoSansSC-Regular.otf"  # Font file

server:
  port: 8000            # Web service port

states:
  E1_seconds: 8         # Duration of each state
  E4_seconds: 8
  E5_seconds: 12
  E6_seconds: 5
```

### Environment Variables

```bash
# Disable GPIO (non-Raspberry Pi environment)
export WATERBOOK_NO_GPIO=1

# Use virtual audio recording
export WATERBOOK_VIRTUAL_AUDIO=1

# Set log level
export WATERBOOK_LOG_LEVEL=DEBUG
```

## üéÆ Usage Instructions

### Raspberry Pi GPIO Operations

- **GPIO17 Short Press**: Confirm/Next step
- **GPIO17 Long Press**: Special operations (skip countdown, etc.)

### Keyboard Operations (Non-GPIO Environment)

- **Space Key**: Short press operation
- **Enter Key**: Long press operation
- **ESC Key**: Exit application
- **F11 Key**: Toggle fullscreen

### Interface Navigation

1. **E0 Attract**: Press any key to start
2. **E1 Guide**: Stand at designated position, wait for countdown or long press to skip
3. **E2 Record**: Speak into microphone, observe real-time spectrum
4. **E3 Generate**: Automatic processing, please wait
5. **E4 Select**: Short press to switch styles, long press to confirm selection
6. **E5 Display**: View artwork, scan QR code to download
7. **E6 Reset**: Automatically reset to E0

## üåê Web Service

The application starts a local web service on port 8000, providing the following features:

- **Artwork Display Page**: `http://localhost:8000/`
- **File Download**: Cover images, animated videos, original audio, metadata
- **QR Code Sharing**: Automatically generates access QR code for current IP
- **Responsive Design**: Supports mobile and tablet access

### Access URLs

- Local access: `http://localhost:8000`
- Network access: `http://[Device IP]:8000`
- QR Code: Displayed in bottom right corner of application interface

## üìÅ Project Structure

```
waterbook_public/
‚îú‚îÄ‚îÄ app.py              # Main program entry
‚îú‚îÄ‚îÄ audio_rec.py        # Audio recording and feature extraction
‚îú‚îÄ‚îÄ generator.py        # Content generation and rule mapping
‚îú‚îÄ‚îÄ visual.py           # UI rendering and interface drawing
‚îú‚îÄ‚îÄ server.py           # Web server
‚îú‚îÄ‚îÄ config.yaml         # Configuration file
‚îú‚îÄ‚îÄ requirements.txt    # Python dependencies
‚îú‚îÄ‚îÄ README.md          # Project documentation
‚îú‚îÄ‚îÄ assets/            # Resource files
‚îÇ   ‚îú‚îÄ‚îÄ words.json     # Onomatopoeia dictionary
‚îÇ   ‚îú‚îÄ‚îÄ fonts/         # Font files
‚îÇ   ‚îú‚îÄ‚îÄ icons/         # Icon files
‚îÇ   ‚îî‚îÄ‚îÄ best_loops/    # Attract loop materials
‚îú‚îÄ‚îÄ www/               # Web output directory
‚îÇ   ‚îú‚îÄ‚îÄ index.html     # Auto-generated homepage
‚îÇ   ‚îú‚îÄ‚îÄ cover.png      # Generated cover
‚îÇ   ‚îú‚îÄ‚îÄ loop.mp4       # Generated animation
‚îÇ   ‚îú‚îÄ‚îÄ raw.wav        # Recorded audio
‚îÇ   ‚îî‚îÄ‚îÄ meta.json      # Metadata
‚îî‚îÄ‚îÄ scripts/           # Script files
    ‚îú‚îÄ‚îÄ run.sh         # Startup script
    ‚îî‚îÄ‚îÄ waterbook.service  # systemd service
```

## üîß Advanced Configuration

### System Service Installation

1. **Copy Service File**
   ```bash
   sudo cp scripts/waterbook.service /etc/systemd/system/
   ```

2. **Modify Service Configuration**
   ```bash
   sudo nano /etc/systemd/system/waterbook.service
   # Modify User, WorkingDirectory, ExecStart and other paths
   ```

3. **Enable Service**
   ```bash
   sudo systemctl daemon-reload
   sudo systemctl enable waterbook.service
   sudo systemctl start waterbook.service
   ```

4. **Check Status**
   ```bash
   sudo systemctl status waterbook.service
   sudo journalctl -u waterbook.service -f
   ```

### Performance Optimization

1. **GPU Memory Allocation** (Raspberry Pi)
   ```bash
   sudo raspi-config
   # Advanced Options -> Memory Split -> 128
   ```

2. **Audio Buffer Optimization**
   ```bash
   # Adjust in config.yaml
   audio:
     frame_ms: 10  # Reduce latency
     buffer_size: 1024  # Adjust buffer size
   ```

3. **Video Generation Optimization**
   ```bash
   # Lower resolution to improve generation speed
   generation:
     video_resolution: [640, 360]
     video_fps: 15
   ```

## üêõ Troubleshooting

### Common Issues

#### 1. Audio Device Issues

**Problem**: Cannot record audio or "device busy" error

**Solution**:
```bash
# Check audio devices
aplay -l
arecord -l

# Kill processes using audio
sudo fuser -k /dev/snd/*

# Restart audio services
sudo systemctl restart alsa-state
sudo systemctl restart pulseaudio

# Check permissions
sudo usermod -a -G audio $USER
```

#### 2. GPIO Permission Issues

**Problem**: GPIO access denied

**Solution**:
```bash
# Add user to gpio group
sudo usermod -a -G gpio $USER

# Check device file permissions
ls -l /dev/gpiomem

# Reboot to take effect
sudo reboot
```

#### 3. Display Issues

**Problem**: Cannot start graphical interface or fullscreen display abnormal

**Solution**:
```bash
# Check display environment
echo $DISPLAY
echo $XDG_RUNTIME_DIR

# Set display permissions
xhost +local:

# Force use X11
export SDL_VIDEODRIVER=x11

# Or use Wayland
export SDL_VIDEODRIVER=wayland
```

#### 4. Dependency Installation Issues

**Problem**: pip installation fails or missing system libraries

**Solution**:
```bash
# Update pip
pip3 install --upgrade pip setuptools wheel

# Install build tools
sudo apt install build-essential python3-dev

# Clear pip cache
pip3 cache purge

# Use domestic mirror
pip3 install -r requirements.txt -i https://pypi.tuna.tsinghua.edu.cn/simple/
```

#### 5. Performance Issues

**Problem**: Application runs slowly or stutters

**Solution**:
```bash
# Check system resources
top
free -h
df -h

# Disable unnecessary services
sudo systemctl disable bluetooth
sudo systemctl disable wifi-powersave

# Adjust configuration to reduce resource consumption
# In config.yaml:
ui:
  width: 1024
  height: 576
audio:
  samplerate: 22050
```

### Log Debugging

```bash
# View application logs
./scripts/run.sh -l

# View system logs
sudo journalctl -u waterbook.service --no-pager

# Enable debug mode
export WATERBOOK_LOG_LEVEL=DEBUG
python3 app.py
```

## ü§ù Development Guide

### Development Environment Setup

```bash
# Clone project
git clone https://github.com/your-repo/waterbook-public.git
cd waterbook-public

# Create development environment
python3 -m venv dev-env
source dev-env/bin/activate

# Install development dependencies
pip install -r requirements.txt
pip install pytest black flake8 mypy

# Run development mode
./scripts/run.sh -d
```

### Code Structure

- **app.py**: Main program and state machine logic
- **visual.py**: UI rendering, contains all drawing functions
- **audio_rec.py**: Audio recording and feature extraction
- **generator.py**: Content generation and rule mapping
- **server.py**: Web server and page generation

### Adding New Features

1. **New State**: Extend state machine in app.py
2. **New Style**: Add style generation logic in generator.py
3. **New UI**: Add drawing functions in visual.py
4. **New Features**: Extend feature extraction in audio_rec.py

## üìÑ License

This project is licensed under the MIT License - see the [LICENSE](LICENSE) file for details.

## üôè Acknowledgments

- [Pygame](https://www.pygame.org/) - Game development library
- [librosa](https://librosa.org/) - Audio analysis library
- [MoviePy](https://zulko.github.io/moviepy/) - Video processing library
- [Pillow](https://pillow.readthedocs.io/) - Image processing library

## üìû Support

If you encounter issues or have suggestions, please:

1. Check the troubleshooting section of this documentation
2. Search existing [Issues](https://github.com/your-repo/waterbook-public/issues)
3. Create a new Issue describing your problem
4. Contact the development team

---

**Waterbook Public** - Transform sound into art, let technology serve creativity üé®‚ú®